# 08. DaemonSet

DaemonSetì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  í´ëŸ¬ìŠ¤í„° ë…¸ë“œë§ˆë‹¤ podë¥¼ í•˜ë‚˜ì”© ì˜¬ë¦´ ìˆ˜ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ëª¨ë“  nodeì—ì„œ ë™ì¼í•˜ê²Œ log ìˆ˜ì§‘ê¸°ë¥¼ êµ¬ë™ ì‹œì¼œì•¼ í•˜ëŠ” ê²½ìš° DaemonSetì„ ì´ìš©í•˜ì—¬ ë°°í¬í•˜ê²Œ ëœë‹¤.

4.4.1 DaemonSetìœ¼ë¡œ ëª¨ë“  nodeì— pod ì‹¤í–‰í•˜ê¸°

DaemonSetìœ¼ë¡œ ìƒì„±ë˜ëŠ” podëŠ” ì˜¬ë¼ê°ˆ ë…¸ë“œê°€ ì´ë¯¸ ì§€ì •ë˜ì–´ ìˆì–´ ë¬´ì‘ìœ„ë¡œ ë°°í¬ë˜ì§€ ì•ŠëŠ”ë‹¤.

* nodeìì²´ê°€ ë‹¤ìš´ë  ê²½ìš° DaemonSetìœ¼ ë‹¤ë¥¸ nodeì— podë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŒ
* ìƒˆë¡œìš´ nodeê°€ í´ëŸ¬ìŠ¤í„°ì— ì¶”ê°€ë  ê²½ìš° í•´ë‹¹ ë…¸ë“œì— ìƒˆë¡œìš´ podìƒì„±í•¨

4.4.2 DaemonSet ì‚¬ìš©í•˜ì—¬ íŠ¹ì • nodeì— podì‹¤í–‰í•˜ê¸°

ë”°ë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ DaemonSetì€ í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  nodeì— podë¥¼ ë°°í¬í•œë‹¤.

íŠ¹ì • ë…¸ë“œë¥¼ ì§€ì •í•˜ê¸° ìœ„í•´ì„œëŠ” node-Selector ì†ì„±ì„ ì´ìš©í•œë‹¤.

\* DaemonSetìœ¼ë¡œ ë°°í¬í•˜ëŠ” podëŠ” ìŠ¤ì¼€ì¤„ë§ì´ disable ë˜ì–´ìˆëŠ” nodeì—ë„ ë°°í¬ëœë‹¤.

&#x20;  ğŸ”¹ DaemonSet YAML ì •ì˜

&#x20;    ë‹¤ìŒì€ 5ì´ˆ ê°„ê²©ìœ¼ë¡œ "SSD OK"ë¥¼ ì¶œë ¥í•˜ëŠ” ëª¨ì˜ ssd-monitor êµ¬ë™ì„ ìœ„í•œ daemonsetì´ë‹¤.

&#x20;    ssd ë ˆì´ë¸”ì´ ìˆëŠ” nodeì— í•œí•´ podë¥¼ í•˜ë‚˜ì”© ì˜¬ë¦¬ê²Œ ëœë‹¤.

```
apiVersion: apps/v1beta2
kind: DaemonSet
metadata:
  name: ssd-monitor
spec:
  selector:
    matchLabels:
      app: ssd-monitor
  template:
    metadata:
      labels:
        app: ssd-monitor
    spec:
      nodeSelector:
        disk: ssd
      containers:
      - name: main
        image: luksa/ssd-monitor
```

&#x20;   ssd ì •ë³´ë¥¼ ê°€ì§„ nodeë¥¼ í™•ì¸í•œë‹¤.

```
root@master001:~/k8s_in_action/kubernetes-in-action/Chapter04# kubectl get node -L disk
NAME        STATUS   ROLES                  AGE   VERSION   DISK
master001   Ready    control-plane,master   34d   v1.20.4   
worker001   Ready    <none>                 34d   v1.20.4   ssd
worker002   Ready    <none>                 34d   v1.20.4
```

&#x20;   DaemonSetìœ¼ë¡œ ssd label ê°’ì´ ìˆëŠ” worker001ì—ë§Œ podê°€ ì˜¬ë¼ê°”ë‹¤.

```
root@master001:~/k8s_in_action/kubernetes-in-action/Chapter04# kubectl get po -o wide
NAME                READY   STATUS    RESTARTS   AGE   IP              NODE        NOMINATED NODE   READINESS GATES
ssd-monitor-5q9w7   1/1     Running   0          39s   172.30.65.108   worker001   <none>           <none>
```
