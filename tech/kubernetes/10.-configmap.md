---
description: 2021. 5. 8. 20:10
---

# 10. ConfigMap

&#x20;

* ì»¨í…Œì´ë„ˆì˜ ì£¼ í”„ë¡œì„¸ìŠ¤ ë³€ê²½
* ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëª…ë ¹ì¤„ ì˜µì…˜ ì „ë‹¬
* ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë…¸ì¶œë˜ëŠ” í™˜ê²½ë³€ìˆ˜ ì„¤ì •
* ì»¨í”¼ê·¸ë§µìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
* ì‹œí¬ë¦¿ìœ¼ë¡œ ë¯¼ê°í•œ ì •ë³´ ì „ë‹¬

####

## ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •

ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¤ì •ê°’ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤.

* ëª…ë ¹ì¤„ ì¸ìˆ˜ë¡œ ì„¤ì •ê°’ ì§€ì •
* ì„¤ì •ê°’ì„ íŒŒì¼ì— ì €ì¥í•˜ì—¬ ì ìš©
  * ë‹¨ì ) í•´ë‹¹ ì„¤ì • íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì•ˆì— í¬í•¨í•˜ê±°ë‚˜, íŒŒì¼ì´ í¬í•¨ëœ ë³¼ë¥¨ì„ mountí•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•´ì„œ ê¹Œë‹¤ë¡­ë‹¤.&#x20;
* í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš© (ex. MYSQL\_ROOT\_PASSWORD)
* Configmap ì´ë€ ì„¤ì • ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤.&#x20;



ì»¨í”¼ê·¸ë§µì„ ì‚¬ìš©í•´ ë‹¤ìŒ ë°©ë²•ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

* ì»¨í…Œì´ë„ˆì— ëª…ë ¹ì¤„ ì¸ìˆ˜ ì „ë‹¬
* ê° ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•œ ì‚¬ìš©ì ì •ì˜ í™˜ê²½ë³€ìˆ˜ ì§€ì •
* íŠ¹ìˆ˜í•œ ìœ í˜•ì˜ ë³¼ë¥¨ì„ í†µí•´ ì„¤ì • íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸

ì´ëŸ¬í•œ í™˜ê²½ë³€ìˆ˜ ì¤‘ì—ì„œ ë³´ì•ˆìƒ ë¯¼ê°í•œ ë‚´ìš©ì€ Secretì´ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ ì „ë‹¬í•˜ê²Œ ëœë‹¤.





## ì»¨í…Œì´ë„ˆì— ëª…ë ¹ì¤„ ì¸ì ì „ë‹¬

### **ë„ì»¤ì—ì„œ ëª…ë ¹ì–´ì™€ ì¸ì ì •ì˜**

ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰í•˜ëŠ” ì „ì²´ ëª…ë ¹ì€ ëª…ë ¹ì–´/ì¸ì ì´ë ‡ê²Œ ë‘ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.

* ENTRYPOINT : ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë  ë•Œ í˜¸ì¶œë  ëª…ë ¹ì–´ ì •ì˜
* CMD : ENTRYPOINT ì— ì „ë‹¬ë˜ëŠ” ì¸ì ì •ì˜

ìœ„ì˜ ë‘ ëª…ë ¹ì–´ íƒ€ì…ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì“°ì¸ë‹¤.

| ì„¤ëª…                   | ë„ì»¤         | ì¿ ë²„ë„¤í‹°ìŠ¤   |
| -------------------- | ---------- | ------- |
| ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì‹¤í–‰ íŒŒì¼ | ENTRYPOINT | command |
| ì‹¤í–‰íŒŒì¼ì— ì „ë‹¬ë˜ëŠ” ì¸ì        | CMD        | args    |





### **Podì—ì„œ ëª…ë ¹ê³¼ ì¸ì ì¬ì •ì˜**

ì»¨í…Œì´ë„ˆë¥¼ ì •ì˜í•  ë•Œ, commandì™€ args ëª¨ë‘ ì •ì˜í•  ìˆ˜ ìˆë‹¤.&#x20;

ìƒì„± í›„ì—ëŠ” argsì˜ value ê°’ì„ ì£¼ë¡œ ì¬ì •ì˜í•œë‹¤.

ì´ë•Œ commandì™€ args í•„ë“œëŠ” pod ìƒì„± í›„ì— ì—…ë°ì´íŠ¸ í•  ìˆ˜ ì—†ë‹¤.&#x20;

```
spec:
  containers:
   - commnad: ["/bin/command"]
     args: ["arg1", "arg2", "arg3"]
```

args valueë¥¼ ì§€ì •í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ì— ì¸ìê°’ì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

```
apiVersion: v1
kind: Pod
metadata:
  name: fortune5s
spec:
  containers:
  - image: luksa/fortune:args
    args: ["5"]
    name: html-generator
...
```

ìœ„ì˜ yaml íŒŒì¼ì—ì„œ argsë¡œ 5ë¥¼ fortuneloop.sh ìŠ¤í¬ë¦½íŠ¸ë¡œ ë„˜ê²¼ë‹¤. ë”°ë¼ì„œ í•´ë‹¹ podëŠ” 5ì´ˆë§ˆë‹¤ ìƒˆë¡œìš´ ìš´ì„¸ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤.

```
root@master001:~/Chapter07# curl http://172.30.65.180
The first thing we do, lets kill all the lawyers.
                -- Wm. Shakespeare, "Henry VI", Part IV
root@master001:~/Chapter07# curl http://172.30.65.180
The first thing we do, lets kill all the lawyers.
                -- Wm. Shakespeare, "Henry VI", Part IV
root@master001:~/Chapter07# curl http://172.30.65.180
FORTUNE PROVIDES QUESTIONS FOR THE GREAT ANSWERS: #19
A:      To be or not to be.
Q:      What is the square root of 4b^2?
```





## ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” podì˜ ê° ì»¨í…Œì´ë„ˆë§ˆë‹¤ ê°œë³„ì ìœ¼ë¡œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

í™˜ê²½ ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸(íŒŒì¼)ë¡œ ê° ì»¨í…Œì´ë„ˆì— ì ìš©ì‹œí‚¤ê²Œ ëœë‹¤.

<div align="left">

<figure><img src="https://blog.kakaocdn.net/dn/x1eZJ/btq4reAqwpF/kaXv11iGtBlWHqKFzTz7ok/img.png" alt=""><figcaption><p>ì»¨í…Œì´ë„ˆë³„ í™˜ê²½ë³€ìˆ˜ ì„¤ì •</p></figcaption></figure>

</div>

ì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ì´ë²ˆì—ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ intervalì„ ì„¤ì •í•´ ë³¸ë‹¤.&#x20;

í™˜ê²½ë³€ìˆ˜ë¡œ ê°’ì„ ê°€ì ¸ì˜¬ ê²ƒì´ê¸° ë•Œë¬¸ì— fortuneloop.sh íŒŒì¼ì—ì„œ ê¸°ì¡´ì—ëŠ” ì¸ìê°’ìœ¼ë¡œ intervalì„ ì´ˆê¸°í™”í•˜ëŠ” ë¶€ë¶„ì„ ì£¼ì„ì²˜ë¦¬í•œë‹¤.&#x20;

```
#!/bin/bash
trap "exit" SIGINT
# INTERVAL=$1 : INTERVALë¥¼ ì¸ìê°’ìœ¼ë¡œ ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •
echo Configured to generate new fortune every $INTERVAL seconds

mkdir -p /var/htdocs

while :
do
  echo $(date) Writing fortune to /var/htdocs/index.html
  /usr/games/fortune > /var/htdocs/index.html
  sleep $INTERVAL
done
```





### **ì»¨í…Œì´ë„ˆ ì •ì˜ì— í™˜ê²½ë³€ìˆ˜ ì§€ì •**

ìƒˆë¡œìš´ fortuneloop.sh íŒŒì¼ì„ í¬í•¨í•œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì—¬ docker í—ˆë¸Œë¡œ í‘¸ì‹œí•œë‹¤.&#x20;

ê·¸ë¦¬ê³  pod ìƒì„±í•˜ëŠ” yaml íŒŒì¼ì˜ í™˜ê²½ë³€ìˆ˜ ëª©ë¡ì— ë‹¨ì¼ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ìƒì„±í•œë‹¤.

ìš´ì„¸ê°€ 1ì´ˆì— í•œë²ˆì”© ë°”ë€Œë„ë¡ INTERVAL í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í–ˆë‹¤.

```
metadata:
  name: fortune-env
spec:
  containers:
  - image: luksa/fortune:env
    env:
    - name: INTERVAL
      value: "1"
```

1ì´ˆë§ˆë‹¤ ìš´ì„¸ ë©”ì‹œì§€ê°€ ë°”ë€Œì–´ì„œ ì¶œë ¥ëœë‹¤.

```
root@master001:~/Chapter07# curl http://172.30.254.30
Bridge ahead.  Pay troll.
root@master001:~/Chapter07# curl http://172.30.254.30
Q:      What is the sound of one cat napping?
A:      Mu.
root@master001:~/Chapter07# curl http://172.30.254.30
You own a dog, but you can only feed a cat.
root@master001:~/Chapter07# curl http://172.30.254.30
You tread upon my patience.
                -- William Shakespeare, "Henry IV"
```



### **ë³€ìˆ˜ì—ì„œ ë‹¤ë¥¸ í™˜ê²½ ë³€ìˆ˜ ì°¸ì¡°**

yaml íŒŒì¼ ì•ˆì— $(VAR)ì„ ì‚¬ìš©í•´ ì´ë¯¸ ì •ì˜ëœ í™˜ê²½ë³€ìˆ˜ë‚˜ ê¸°íƒ€ ê¸°ì¡´ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

```
env:
- name: FIRST_VAR
  value: "Wongyeong"
- name: SECOND_VAR
  value: "$(FIRST_VAR)LEE"
```



### **í•˜ë“œì½”ë”©ëœ í™˜ê²½ë³€ìˆ˜ì˜ ë‹¨ì **

podì˜ yaml íŒŒì¼ì— í™˜ê²½ë³€ìˆ˜ë¥¼ í•˜ë“œì½”ë”©í•˜ëŠ” ê²ƒì€ ë™ì¼í•œ podì—ë„ ê°™ì€ ì„¤ì •ì„ ì¼ì¼íˆ í•´ì•¼í•¨ì„ ì˜ë¯¸í•œë‹¤.

ë”°ë¼ì„œ ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ë™ì¼í•œ ì •ì˜ë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì»¨í”¼ê·¸ë§µ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•´ í™˜ê²½ë³€ìˆ˜ ë‚´ìš©ì„ pod ì •ì˜ì—ì„œ ë¶„ë¦¬í•œë‹¤.





## ConfigMapìœ¼ë¡œ ì„¤ì • ë¶„ë¦¬

í™˜ê²½ì— ë”°ë¼ ë‹¤ë¥´ê±°ë‚˜ ìì£¼ ë³€ê²½ë˜ëŠ” ì˜µì…˜ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì •ì˜ ì†ŒìŠ¤ì™€ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•œë‹¤.

ConfigMapìœ¼ë¡œ ì´ëŸ¬í•œ ì„¤ì •ê°’ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.



### **ConfigMap?**

* ConfigMapì€ ì„¤ì •ê°’ì˜ ë‚´ìš©ì„ key-value ìŒìœ¼ë¡œ êµ¬ì„±í•œ ë§µì´ë‹¤.
* ConfigMapì˜ ë‚´ìš©ì€ ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ë³¼ë¥¨ íŒŒì¼ë¡œ ì „ë‹¬ëœë‹¤.&#x20;
* PodëŠ” ConfigMapì„ ì´ë¦„ìœ¼ë¡œ ì°¸ì¡°í•œë‹¤.
  * ì„œë¡œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë™ì¼í•œ ì´ë¦„ì˜ ConfigMapì„ ìƒì„±í•´ë„ ê° ì»¨í”¼ê·¸ë§µì€ ê°œë³„ì ìœ¼ë¡œ ê´€ë¦¬ëœë‹¤.



### **ConfigMap ìƒì„±**

#### kubectl create configmap

```
root@master001:~/Chapter07# kubectl create configmap fortune-config --from-literal=sleep-interval=10
configmap/fortune-config created
```

* from-literal : ë¬¸ìì—´ í•­ëª©ì„ ì¶”ê°€ ê°€ëŠ¥í•˜ë©°, í•´ë‹¹ ì˜µì…˜ì„ ì—¬ëŸ¬ë²ˆ ì „ë‹¬í•˜ì—¬ ì—¬ëŸ¬ ë¬¸ìì—´ í•­ëª© ì¶”ê°€ ê°€ëŠ¥

ìœ„ ëª…ë ¹ì–´ë¡œ sleep-interval=20ì´ë¼ëŠ” ë‹¨ì¼ í•­ëª©ì„ ê°€ì§„ configmapì´ ìƒì„±ëœë‹¤.

<figure><img src="https://blog.kakaocdn.net/dn/lVk8O/btq4o7vxBPw/XntPldhCzVCnlUMQ0mtkL1/img.png" alt=""><figcaption></figcaption></figure>

í•´ë‹¹ configmapì— ì„¤ì •ëœ í•­ëª©ê³¼ mapì˜ ì´ë¦„ì„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.

```
root@master001:~/Chapter07# kubectl get configmap fortune-config -o yaml
apiVersion: v1
data:
  sleep-interval: "10"
kind: ConfigMap
metadata:
  creationTimestamp: "2021-05-08T10:48:10Z"
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: {}
        f:sleep-interval: {}
    manager: kubectl-create
    operation: Update
    time: "2021-05-08T10:48:10Z"
  name: fortune-config
  namespace: default
  resourceVersion: "15407755"
  uid: e19889c4-83bc-49ac-a01c-7b013074bec0
```

#### íŒŒì¼ ë‚´ìš©ìœ¼ë¡œ ConfigMap ìƒì„±

ì»¨í”¼ê·¸ë§µì— ì „ì²´ ì„¤ì • íŒŒì¼ê³¼ ê°™ì€ ë°ì´í„°ë¥¼ í†µìœ¼ë¡œ ì €ì¥í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

```
$ kubectl create configmap my-config --from-file=config-file.conf

# ìˆ˜ë™ìœ¼ë¡œ key ì§€ì • ê°€ëŠ¥: customkeyë¡œ ì§€ì •í•˜ëŠ” ì˜ˆ
$ kubectl create configmap my-config --from-file=customkey=config-file.conf
```

#### ë””ë ‰í„°ë¦¬ì— ìˆëŠ” íŒŒì¼ë¡œ ìƒì„±

ë””ë ‰í„°ë¦¬ ì•ˆì˜ ëª¨ë“  íŒŒì¼ì„ ê°€ì ¸ì™€ì„œ ìƒì„±í•œë‹¤.

ê° íŒŒì¼ì„ ê°œë³„ í•­ëª©ìœ¼ë¡œ ì €ì¥í•˜ë©°, ì´ë•Œ íŒŒì¼ì´ë¦„ì´ keyë¡œ ì‚¬ìš©í•˜ê¸°ì— ìœ íš¨í•œ íŒŒì¼ë§Œ ì¶”ê°€í•œë‹¤.

```
$ kubectl create configmap my-config --from-file=/path/to/dir
```

#### ë‹¤ì–‘í•œ ì˜µì…˜ ê²°í•©

ìœ„ì˜ ë°©ë²•ë“¤ì„ ì¡°í•©í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```
$ kubectl create configmap my-config \
  --from-file=foo.json \         # ë‹¨ì¼ íŒŒì¼
  --from-file=bar=foobar.conf \  # ì‚¬ìš©ì ì •ì˜ key ë°‘ì— ì €ì¥ëœ íŒŒì¼
  --from-file=config-opts/ \     # ë””ë ‰í„°ë¦¬
  --from-literal=some=thing      # ë¬¸ìì—´ ê°’
```

###

### **ConfigMap í•­ëª©ì„ í™˜ê²½ë³€ìˆ˜ë¡œ ì»¨í…Œì´ë„ˆì— ì „ë‹¬**

ì´ì œ ConfigMapì„ Podì•ˆì˜ ì»¨í…Œì´ë„ˆì— ì „ë‹¬í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³¸ë‹¤.

ì´ì—ëŠ” ì—¬ëŸ¬ ì˜µì…˜ì´ ìˆë‹¤.

1. env.valueFrom
2. envFrom

valueFrom ì„ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ë¥¼ ConfigMapì—ì„œ ê°€ì ¸ì˜¤ë„ë¡ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤.

```
apiVersion: v1
kind: Pod
metadata:
  name: fortune-env-from-configmap
  labels:
    app: kubia
spec:
  containers:
    - image: luksa/fortune:env
      name: html-generator
      env:
        - name: INTERVAL          
          valueFrom:
            configMapKeyRef: 
              name: fortune-config  # ì´ë¦„ì„ í†µí•œ ConfigMap ì°¸ì¡° 
              key: sleep-interval   # fortune-config ì˜ sleep-interval í‚¤ì— ì €ì¥ëœ ê°’ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
...
```

ì´ ìƒí™©ì—ì„œ ë§Œì•½ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ConfigMapì„ ì°¸ì¡°í•  ê²½ìš° í•´ë‹¹ ì»¨í…Œì´ë„ˆëŠ” ì‹œì‘ë˜ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ í›„ì— í•´ë‹¹ ConfigMapì´ ìƒì„±ë˜ë©´ ì‹¤íŒ¨ëœ ì»¨í…Œì´ë„ˆë„ ìë™ìœ¼ë¡œ ì˜¬ë¼ì˜¤ê²Œ ëœë‹¤.

( optional: true ë¥¼ ì„¤ì •í•˜ë©´ ì»¨í”¼ê·¸ë§µì„ ëª»ì°¾ì•„ë„ ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘ì‹œí‚¨ë‹¤)





### **ConfigMapì˜ ëª¨ë“  í•­ëª©ì„ í•œ ë²ˆì— í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬**

envFrom ì†ì„±ì„ ì‚¬ìš©í•´ ConfigMapì˜ ëª¨ë“  í•­ëª©ì„ í™˜ê²½ë³€ìˆ˜ë¡œ ë…¸ì¶œí•  ìˆ˜ ìˆë‹¤.

```
spec:
  containers:
    - image: some-image
      envFrom:                    #  envëŒ€ì‹  envFrom 
        - prefix: CONFIG_         #  ëª¨ë“  í™˜ê²½ë³€ìˆ˜ëŠ” CONFIG_ ì ‘ë‘ì‚¬ë¥¼ ê°€ì§             
          configMapKeyRef:        #  my-config-mapì´ë€ ì´ë¦„ì˜ ì»¨í”¼ê·¸ë§µ ì°¸ì¡°
            name: my-config-map
```

ConfigMapì— FOO, BAR ë¼ëŠ” í‚¤ê°€ ìˆë‹¤ë©´, ì»¨í…Œì´ë„ˆì—ëŠ” CONFIG\_FOO, CONFIG\_BAR ë¼ëŠ” í™˜ê²½ ë³€ìˆ˜ê°€ ì ìš©ëœë‹¤.

FOO-BAR ê°™ì€ ê²½ìš°ëŠ” ëŒ€ì‹œ(-)ë¥¼ í¬í•¨í•˜ì—¬ ì˜¬ë°”ë¥¸ í™˜ê²½ë³€ìˆ˜ ì´ë¦„ì´ ë  ìˆ˜ ì—†ë‹¤.





### **ConfigMap í•­ëª©ì„ ëª…ë ¹ì¤„ ì¸ìë¡œ ì „ë‹¬**

ì»¨í”¼ê·¸ë§µ í•­ëª©ì„ ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ ë³€ìˆ˜ë¡œ ì´ˆê¸°í™”í•˜ì—¬ ì‚¬ìš©

```
apiVersion: v1
kind: Pod
metadata:
  name: fortune2s-args-configmap
  labels:
    app: kubia
spec:
  containers: 
    - image: luksa/fortune:args  # í™˜ê²½ë³€ìˆ˜ê°€ ì•„ë‹Œ args ë¡œ ë¶€í„° INTERVAL ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì´ë¯¸ì§€ ì‚¬ìš©
      name: html-generator
      env:
        - name: INTERVAL         # ConfigMap ì‚¬ìš©í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ INTERVAL ì •ì˜ 
          valueFrom:
            configMapKeyRef:
              name: fortune-config
              key: sleep-interval
      args: ["$(INTERVAL)"]       # í™˜ê²½ë³€ìˆ˜ INTERVAL ë¡œ ì§€ì •í•œ ê°’ì„ argument ë¡œ ì‚¬ìš©
```



### **ConfigMap ë³¼ë¥¨ì„ ì‚¬ìš©í•œ ì „ë‹¬**

ConfigMap ë³¼ë¥¨ì„ ì‚¬ìš©í•´ íŒŒì¼ë¡œ ì»¨í”¼ê·¸ë©ì˜ ê° í•­ëª©ì„ ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆë‹¤.

ì´ëŠ” ëŒ€ë¶€ë¶„ ëŒ€í˜• ì„¤ì • íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì— ì „ë‹¬í•˜ëŠ” ìš©ë„ë¡œ ì“°ì¸ë‹¤.

#### ConfigMap ìƒì„±

Nginx ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì • íŒŒì¼ë¡œ ì„¸íŒ….

Nginx ì»¨í…Œì´ë„ˆëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µì„ ì••ì¶•í•´ì„œ ë³´ë‚´ëŠ” ì—­í• ì„ í•œë‹¤.

```
$ vi configmap-files/my-nginx-config.conf
server {
  listen  80;
  server_name www.kubia-example.com;

  # í‰ë¬¸ ë° xml íŒŒì¼ì— ëŒ€í•´ gzip ì••ì¶• í™œì„±í™”
  gzip  on;
  gzip_types  text/plain application/xml;

  location / {
    root /usr/share/nginx/html;
    index index.html index.htm;
  }
}
```

configmap-files ë””ë ‰í„°ë¦¬ í•˜ìœ„ì— ìˆëŠ” ëª¨ë“  íŒŒì¼ì„ ì‚¬ìš©í•œ ì»¨í”¼ê·¸ë§µì„ ìƒì„±í•œë‹¤.

```
root@master001:~/Chapter07# kubectl create configmap fortune-config --from-file=configmap-files
configmap/fortune-config created
```

í•´ë‹¹ ConfigMapì˜ yaml íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```
root@master001:~/Chapter07# kubectl get configmap fortune-config -o yaml
apiVersion: v1
data:
  my-nginx-config.conf: |
    server {
        listen              80;
        server_name         www.kubia-example.com;

        gzip on;
        gzip_types text/plain application/xml;

        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }

    }
  sleep-interval: |
    25
kind: ConfigMap
metadata:
  creationTimestamp: "2021-05-08T15:24:57Z"
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: {}
        f:my-nginx-config.conf: {}
        f:sleep-interval: {}
    manager: kubectl-create
    operation: Update
    time: "2021-05-08T15:24:57Z"
  name: fortune-config
  namespace: default
  resourceVersion: "15449748"
  uid: bd477478-5516-4758-b54f-72f9e3d0699c
```

data í•˜ìœ„ë¡œ my-nginx-config.confì™€ sleep-interval ì„¤ì •ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì´ì œ ì´ ì»¨í”¼ê·¸ë§µì„ ë‘ ì»¨í…Œì´ë„ˆì—ì„œ ë™ì‹œì— ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤.



#### ë³¼ë¥¨ ì•ˆì— ìˆëŠ” ConfigMap í•­ëª© ì‚¬ìš©

ConfigMapì˜ ë‚´ìš©ì„ ê°€ì§„ ë³¼ë¥¨ì„ ìƒì„±í•œë‹¤.

ConfigMap í•­ëª©ì„ íŒŒì¼ë¡œ ë§ˆìš´íŠ¸í•œ podëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.

```
apiVersion: v1
kind: Pod
metadata:
  name: fortune-configmap-volume
spec:
  containers:
  - image: luksa/fortune:env
    env:
    - name: INTERVAL
      valueFrom:
        configMapKeyRef:
          name: fortune-config
          key: sleep-interval
    name: html-generator
    volumeMounts:
    - name: html
      mountPath: /var/htdocs
  - image: nginx:alpine
    name: web-server
    volumeMounts:
    - name: html
      mountPath: /usr/share/nginx/html
      readOnly: true
    - name: config
      mountPath: /etc/nginx/conf.d     # <- ì»¨í”¼ê·¸ë§µ ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ëŠ” ìœ„ì¹˜
      readOnly: true
    - name: config                     
      mountPath: /tmp/whole-fortune-config-volume
      readOnly: true
    ports:
      - containerPort: 80
        name: http
        protocol: TCP
  volumes:
  - name: html
    emptyDir: {}
  - name: config       # <- í•´ë‹¹ ë³¼ë¥¨ì€ fortune-config ì»¨í”¼ê·¸ë§µì„ ì°¸ì¡°
    configMap:
      name: fortune-config
```

nginxëŠ” /etc/nginx/nginx.conf íŒŒì¼ì˜ ì„¤ì •ê°’ì„ ì½ëŠ”ë‹¤.

nginx.conf íŒŒì¼ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ /etc/nginx/conf.d/ ë””ë ‰í„°ë¦¬ ì•ˆì— ìˆëŠ” ëª¨ë“  .conf íŒŒì¼ì„ ì½ë„ë¡ ë˜ì–´ìˆë‹¤.

```
  include /etc/nginx/conf.d/*.conf
```

ë”°ë¼ì„œ ìœ„ì˜ yamlíŒŒì¼ì—ì„œ config ë³¼ë¥¨ì´ fortune-config ì˜ ì»¨í”¼ê·¸ë§µì„ ì°¸ì¡°í•¨ì— ë”°ë¼ nginx ì»¨í…Œì´ë„ˆëŠ” fortune-config ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.

\<nginxì˜ ConfigMap ë³¼ë¥¨ê³¼ ë§ˆìš´íŠ¸ëœ ë””ë ‰í„°ë¦¬ í™•ì¸>

```
root@master001:~/Chapter07# kubectl exec fortune-configmap-volume -c web-server -- ls /etc/nginx/conf.d
my-nginx-config.conf
sleep-interval
```

ë‹¨, ì´ë•Œ sleep-intervalì€ html-generator ì»¨í…Œì´ë„ˆì—ì„œ ì“°ì´ëŠ” ê²ƒìœ¼ë¡œ, web-serverì—ëŠ” ë…¸ì¶œë  í•„ìš”ê°€ ì—†ë‹¤.

ë”°ë¼ì„œ ë¶ˆë¥¨ì— íŠ¹ì • ConfigMap í•­ëª©ë§Œ ë…¸ì¶œí•˜ëŠ” ë²•ì„ ì•Œì•„ë³¸ë‹¤.

```
  volumes:
  - name: html
    emptyDir: {}
  - name: config
    configMap:
      name: fortune-config
      items:    # <- ë³¼ë¥¨ì— í¬í•¨í•  í•­ëª©ì„ ì¡°íšŒí•˜ì—¬ ì„ íƒ 
      - key: my-nginx-config.conf      # <- í•´ë‹¹ valueë¥¼ ê°œë³„ì ìœ¼ë¡œ ì„ íƒ
        path: gzip.conf                # <- gzip.conf ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ë¡œ /etc/nginx/conf.dì— ìƒì„±
```

\<nginxì˜ ConfigMap ë³¼ë¥¨ê³¼ ë§ˆìš´íŠ¸ëœ ë””ë ‰í„°ë¦¬ í™•ì¸>

```
root@master001:~/Chapter07# kubectl exec fortune-configmap-volume-with-items -c web-server -- ls /etc/nginx/conf.d
gzip.conf
```

ğŸ˜¨ \
mountë¥¼ í•˜ë©´ ë§ˆìš´íŠ¸í•œ íŒŒì¼ ì‹œìŠ¤í…œì— ìˆëŠ” íŒŒì¼ë§Œ í¬í•¨í•˜ê³ , ê¸°ì¡´ì— ë¡œì»¬(ì»¨í…Œì´ë„ˆ)ì˜ í•´ë‹¹ ê²½ë¡œì— ìˆëŠ” íŒŒì¼ì€ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.\
ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ì„œëŠ” ê°œë³„ ConfigMap í•­ëª©ì„ íŒŒì¼ë¡œ ë§ˆìš´íŠ¸ í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤.



#### ê°œë³„ ConfigMap í•­ëª©ì„ fileë¡œ ë§ˆìš´íŠ¸í•˜ê¸°

ì „ì²´ ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸ í•˜ëŠ”ëŒ€ì‹  volumeMountì— subPath ì†ì„±ìœ¼ë¡œ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ í•˜ë‚˜ë§Œì„ ë³¼ë¥¨ì— ë§ˆìš´íŠ¸ í•  ìˆ˜ ìˆë‹¤.

<div align="left">

<figure><img src="https://blog.kakaocdn.net/dn/ceLpTV/btq4o7bm0xT/MJYUEyyPD9D50sDBf4MTV0/img.jpg" alt=""><figcaption></figcaption></figure>

</div>

```
spec:
  containers:
    - image: some/image
      volumeMounts:
        - name: myvolume
          mountPath: /etc/someconfig.conf   # ì»¨í…Œì´ë„ˆì˜ ë””ë ‰í„°ë¦¬ê°€ ì•„ë‹Œ íŒŒì¼ì„ ë§ˆìš´íŠ¸
          subPath: myconfig.conf            # ConfigMap ë³¼ë¥¨ì˜ myconfig.conf í•­ëª©ë§Œ ë§ˆìš´íŠ¸ 
```

í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ íŒŒì¼ ì—…ë°ì´íŠ¸ì— ê²°í•¨ì„ ê°€ì§€ê³  ìˆë‹¤.



#### ConfigMap ë¶ˆë¥¨ ì•ˆì— ìˆëŠ” íŒŒì¼ ê¶Œí•œ ì„¤ì •

ê¸°ë³¸ì ìœ¼ë¡œ ConfigMap ë³¼ë¥¨ì˜ ëª¨ë“  íŒŒì¼ ê¶Œí•œì€ 0644ë¡œ ì„¤ì •ë˜ë©°, ì´ëŠ” defaultMode ì†ì„±ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

```
  volumes:
  - name: html
    emptyDir: {}
  - name: config
    configMap:
      name: fortune-config
      defaultMode: 0660
```

ConfigMapì€ ë³´ì•ˆìƒ ì¤‘ìš”í•˜ì§€ ì•Šì€ ì„¤ì • ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ”ë° ì£¼ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ,

í•„ìš”ì— ë”°ë¼ íŒŒì¼ì˜ ê¶Œí•œì„ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤.



### **ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ì—†ì´ ì„¤ì • ì—…ë°ì´íŠ¸**

í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ëª…ë ¹ì¤„ ì¸ìˆ˜ë¥¼ ì„¤ì • ì†ŒìŠ¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì˜ ë‹¨ì ì€ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤.

ì´ëŠ” ConfigMapì„ ë³¼ë¥¨ìœ¼ë¡œ ë…¸ì¶œí•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¬ì‹œì‘ ì—†ì´ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆë‹¤.

ConfigMapì„ ì—…ë°ì´íŠ¸í•˜ë©´, ì´ë¥¼ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ë³¼ë¥¨ì˜ íŒŒì¼ì´ ì—…ë°ì´íŠ¸ëœë‹¤.

#### ì»¨í”¼ê·¸ë§µ í¸ì§‘

ConfigMap í¸ì§‘ í›„ pod ì•ˆì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ê°€ ConfigMap ë³¼ë¥¨ì— ë…¸ì¶œëœ íŒŒì¼ì„ ë‹¤ì‹œ ë¡œë“œí•˜ë„ë¡ í•œë‹¤.

1\) ConfigMap í¸ì§‘

gzip on -> gzip offë¡œ ìˆ˜ì •

```
root@master001:~/Chapter07# vi fortune-pod-configmap-volume-defaultMode.yaml
configmap/fortune-config edited
```

vi ë¡œ íŒŒì¼ì„ ì €ì¥í•˜ê³  ë‚˜ì˜¤ëŠ” ìˆœê°„ ConfigMapì´ ì—…ë°ì´íŠ¸ ë˜ë©´ì„œ ë³¼ë¥¨ì˜ ì‹¤ì œ íŒŒì¼ë„ ì—…ë°ì´íŠ¸ ëœë‹¤.

```
root@master001:~/Chapter07# kubectl exec fortune-configmap-volume -c web-server cat /etc/nginx/conf.d/my-nginx-config.conf
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
server {
    listen              80;
    server_name         www.kubia-example.com;

    gzip off;
    gzip_types text/plain application/xml;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

}
```

ìœ„ì™€ ê°™ì´ íŒŒì¼ì´ ì—…ë°ì´íŠ¸ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ë‹¤ë§Œ nginxëŠ” íŒŒì¼ì˜ ë³€ê²½ì„ ê°ì‹œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‹¤ì§ˆì ìœ¼ë¡œ ë°˜ì˜ë˜ì§€ëŠ” ì•Šì•˜ë‹¤.

ë”°ë¼ì„œ Nginxì—ê²Œ ì„¤ì •íŒŒì¼ì„ ë‹¤ì‹œ ë¡œë“œí•˜ë„ë¡ í•œë‹¤.

```
root@master001:~/Chapter07# kubectl exec fortune-configmap-volume -c web-server -- nginx -s reload
2021/05/09 02:27:04 [notice] 34#34: signal process started
```

ì´ëŠ” ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›ë³¸ íŒŒì¼ì„ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•˜ë‹¤.

```
root@master001:~/Chapter07# kubectl exec -it fortune-configmap-volume -c web-server -- ls -lA /etc/nginx/conf.d
total 4
drwxr-xr-x    2 root     root          4096 May  9 02:23 ..2021_05_09_02_23_08.552611578
lrwxrwxrwx    1 root     root            31 May  9 02:23 ..data -> ..2021_05_09_02_23_08.552611578
lrwxrwxrwx    1 root     root            27 May  8 15:50 my-nginx-config.conf -> ..data/my-nginx-config.conf
lrwxrwxrwx    1 root     root            21 May  8 15:50 sleep-interval -> ..data/sleep-interval
```

