# 02. YAML ë˜ëŠ” JSON ë””ìŠ¤í¬ë¦½í„°ë¡œ Pod ìƒì„±í•˜ê¸°

â€» ë³¸ ê²Œì‹œê¸€ì€ ë„ì„œ <ì¿ ë²„ë„¤í‹°ìŠ¤ ì¸ ì•¡ì…˜>ì„ í† ëŒ€ë¡œ ì •ë¦¬/í•™ìŠµí•œ ë‚´ìš©ì…ë‹ˆë‹¤.

Pod, Deployment, Service ë“±ê³¼ ê°™ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ REST API ì—”ë“œí¬ì¸íŠ¸ì— ìƒì„±í•˜ë ¤ëŠ” ë¦¬ì†ŒìŠ¤ì˜ ëª…ì„¸ì„œë¥¼ ì „ì†¡í•˜ì—¬ ìƒì„±í•œë‹¤.

ì´ë•Œ ëª…ì„¸ì„œëŠ” yaml, json ê³¼ ê°™ì€ íŒŒì¼ í˜•ì‹ì„ ê°€ì§„ë‹¤.

3.2.1 ê¸°ì¡´ podì˜ yaml ë””ìŠ¤í¬ë¦½í„°

\-o yaml ì˜µì…˜ìœ¼ë¡œ podì— ëŒ€í•œ yaml ì •ì˜ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

```
root@master001:~# kubectl get po kubia-manual -o yaml
```

yaml ì •ì˜ë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.

ë”ë³´ê¸°

root@master001:\~# kubectl run kubia --image=luksa/kubia --port=8080 --generator=run/v1

root@master001:\~# kubectl get po kubia -o yaml

apiVersion: v1   # í•´ë‹¹ objectë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” kubernetes api ë²„ì „

kind: Pod        # ìƒì„±í•  objectì˜ ìœ í˜•

metadata:  # objectì˜ ì´ë¦„, uid, namespace, label ë“±ì— ëŒ€í•œ metadata

&#x20; annotations:

&#x20;   cni.projectcalico.org/podIP: 172.30.254.29/32

&#x20;   cni.projectcalico.org/podIPs: 172.30.254.29/32

&#x20; creationTimestamp: "2021-04-03T13:14:06Z"

&#x20; labels:

&#x20;   run: kubia

&#x20; managedFields:

&#x20; \- apiVersion: v1

&#x20;   fieldsType: FieldsV1

&#x20;   fieldsV1:

&#x20;     f:metadata:

&#x20;       f:labels:

&#x20;         .: {}

&#x20;         f:run: {}

&#x20;     f:spec:

&#x20;       f:containers:

&#x20;         k:{"name":"kubia"}:

&#x20;           .: {}

&#x20;           f:image: {}

&#x20;           f:imagePullPolicy: {}

&#x20;           f:name: {}

&#x20;           f:ports:

&#x20;             .: {}

&#x20;             k:{"containerPort":8080,"protocol":"TCP"}:

&#x20;               .: {}

&#x20;               f:containerPort: {}

&#x20;               f:protocol: {}

&#x20;           f:resources: {}

&#x20;           f:terminationMessagePath: {}

&#x20;           f:terminationMessagePolicy: {}

&#x20;       f:dnsPolicy: {}

&#x20;       f:enableServiceLinks: {}

&#x20;       f:restartPolicy: {}

&#x20;       f:schedulerName: {}

&#x20;       f:securityContext: {}

&#x20;       f:terminationGracePeriodSeconds: {}

&#x20;   manager: kubectl-run

&#x20;   operation: Update

&#x20;   time: "2021-04-03T13:14:06Z"

&#x20; \- apiVersion: v1

&#x20;   fieldsType: FieldsV1

&#x20;   fieldsV1:

&#x20;     f:metadata:

&#x20;       f:annotations:

&#x20;         .: {}

&#x20;         f:cni.projectcalico.org/podIP: {}

&#x20;         f:cni.projectcalico.org/podIPs: {}

&#x20;   manager: calico

&#x20;   operation: Update

&#x20;   time: "2021-04-03T13:14:07Z"

&#x20; \- apiVersion: v1

&#x20;   fieldsType: FieldsV1

&#x20;   fieldsV1:

&#x20;     f:status:

&#x20;       f:conditions:

&#x20;         k:{"type":"ContainersReady"}:

&#x20;           .: {}

&#x20;           f:lastProbeTime: {}

&#x20;           f:lastTransitionTime: {}

&#x20;           f:status: {}

&#x20;           f:type: {}

&#x20;         k:{"type":"Initialized"}:

&#x20;           .: {}

&#x20;           f:lastProbeTime: {}

&#x20;           f:lastTransitionTime: {}

&#x20;           f:status: {}

&#x20;           f:type: {}

&#x20;         k:{"type":"Ready"}:

&#x20;           .: {}

&#x20;           f:lastProbeTime: {}

&#x20;           f:lastTransitionTime: {}

&#x20;           f:status: {}

&#x20;           f:type: {}

&#x20;       f:containerStatuses: {}

&#x20;       f:hostIP: {}

&#x20;       f:phase: {}

&#x20;       f:podIP: {}

&#x20;       f:podIPs:

&#x20;         .: {}

&#x20;         k:{"ip":"172.30.254.29"}:

&#x20;           .: {}

&#x20;           f:ip: {}

&#x20;       f:startTime: {}

&#x20;   manager: kubelet

&#x20;   operation: Update

&#x20;   time: "2021-04-03T13:14:42Z"

&#x20; name: kubia

&#x20; namespace: default

&#x20; resourceVersion: "6920138"

&#x20; uid: 73cae115-aeb9-4618-804d-38c08ed4e8cf

spec:     # í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì •ì˜/ë‚´ìš© (podì— ì†í•œ container ì •ë³´, volume ë“±)

&#x20; containers:

&#x20; \- image: luksa/kubia

&#x20;   imagePullPolicy: Always

&#x20;   name: kubia

&#x20;   ports:

&#x20;   \- containerPort: 8080

&#x20;     protocol: TCP

&#x20;   resources: {}

&#x20;   terminationMessagePath: /dev/termination-log

&#x20;   terminationMessagePolicy: File

&#x20;   volumeMounts:

&#x20;   \- mountPath: /var/run/secrets/kubernetes.io/serviceaccount

&#x20;     name: default-token-xgl85

&#x20;     readOnly: true

&#x20; dnsPolicy: ClusterFirst

&#x20; enableServiceLinks: true

&#x20; nodeName: worker002

&#x20; preemptionPolicy: PreemptLowerPriority

&#x20; priority: 0

&#x20; restartPolicy: Always

&#x20; schedulerName: default-scheduler

&#x20; securityContext: {}

&#x20; serviceAccount: default

&#x20; serviceAccountName: default

&#x20; terminationGracePeriodSeconds: 30

&#x20; tolerations:

&#x20; \- effect: NoExecute

&#x20;   key: node.kubernetes.io/not-ready

&#x20;   operator: Exists

&#x20;   tolerationSeconds: 300

&#x20; \- effect: NoExecute

&#x20;   key: node.kubernetes.io/unreachable

&#x20;   operator: Exists

&#x20;   tolerationSeconds: 300

&#x20; volumes:

&#x20; \- name: default-token-xgl85

&#x20;   secret:

&#x20;     defaultMode: 420

&#x20;     secretName: default-token-xgl85

status:      # podì™€ ê·¸ ì•ˆì˜ containerì˜ ìƒì„¸í•œ ìƒíƒœ

&#x20; conditions:

&#x20; \- lastProbeTime: null

&#x20;   lastTransitionTime: "2021-04-03T13:14:06Z"

&#x20;   status: "True"

&#x20;   type: Initialized

&#x20; \- lastProbeTime: null

&#x20;   lastTransitionTime: "2021-04-03T13:14:42Z"

&#x20;   status: "True"

&#x20;   type: Ready

&#x20; \- lastProbeTime: null

&#x20;   lastTransitionTime: "2021-04-03T13:14:42Z"

&#x20;   status: "True"

&#x20;   type: ContainersReady

&#x20; \- lastProbeTime: null

&#x20;   lastTransitionTime: "2021-04-03T13:14:06Z"

&#x20;   status: "True"

&#x20;   type: PodScheduled

&#x20; containerStatuses:

&#x20; \- containerID: docker://7fd367dc382a19a2628ee52c5a8975f9d04071aec4f88fec2a1f6b4c76333d20

&#x20;   image: luksa/kubia:latest

&#x20;   imageID: docker-pullable://luksa/kubia@sha256:3f28e304dc0f63dc30f273a4202096f0fa0d08510bd2ee7e1032ce600616de24

&#x20;   lastState: {}

&#x20;   name: kubia

&#x20;   ready: true

&#x20;   restartCount: 0

&#x20;   started: true

&#x20;   state:

&#x20;     running:

&#x20;       startedAt: "2021-04-03T13:14:41Z"

&#x20; hostIP: 10.10.11.21

&#x20; phase: Running

&#x20; podIP: 172.30.254.29

&#x20; podIPs:

&#x20; \- ip: 172.30.254.29

&#x20; qosClass: BestEffort

&#x20; startTime: "2021-04-03T13:14:06Z"

* Metadata : ì´ë¦„, namespace, label, pod ì— ê´€í•œ ê¸°íƒ€ ì •ë³´
* Spec : pod ìì²´ì— ëŒ€í•œ ì‹¤ì œ ëª…ì„¸ì´ë©°, k8s clusterì—ì„œ ìœ ì§€í•  ìƒíƒœì— ëŒ€í•œ ë‚´ìš©ì´ë‹¤. (pod container, volume, ê¸°íƒ€ ë°ì´í„° ë“±)
* Status : í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ podì— ëŒ€í•œ í˜„ì¬ ì •ë³´ (Podì˜ ìƒíƒœ, ê° container ì„¤ëª…ê³¼ ìƒíƒœ, pod ë‚´ë¶€ ip, ê¸°íƒ€ ì •ë³´ ë“±)

Statusì˜ ê²½ìš° objectì˜ ìƒì„± ëª…ë ¹ì´ ë‚´ë ¤ì§„ ì´í›„ì˜ ë¦¬ì†ŒìŠ¤ ìƒíƒœë¥¼ ë³´ì—¬ì¤€ë‹¤.

ë”°ë¼ì„œ ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“¤ë•Œ status ë¶€ë¶„ì€ ì‘ì„±í•  í•„ìš”ê°€ ì—†ë‹¤.

3.2.2 Podë¥¼ ì •ì˜í•˜ëŠ” ê°„ë‹¨í•œ YAML ì‘ì„±í•˜ê¸°

yaml íŒŒì¼ì„ ì‘ì„±í•˜ì—¬ ìƒˆë¡œìš´ podë¥¼ ë§Œë“¤ì–´ë³´ë„ë¡ í•œë‹¤.

```
root@master001:~/k8s_in_action/03_pod# cat kubia-manual.yaml
apiVersion: v1
kind: Pod
metadata:
  name: kubia-manual
spec:
  containers:
  - image: luksa/kubia
    name: kubia
    ports:
    - containerPort: 8080
      protocol: TCP
```

* apiVersion : ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“œë©´ì„œ ì‚¬ìš©í•  API ë²„ì „.&#x20;
* kind : Pod ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê² ë‹¤ê³  ì •ì˜
* metadata : podì˜ ì´ë¦„ ì •ì˜
* spec/containers/image : ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€
* spec/containers/ports : ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìˆ˜ì‹ í•˜ëŠ” í¬íŠ¸

&#x20;  ğŸ”¹ ì»¨í…Œì´ë„ˆ í¬íŠ¸ ì§€ì •

&#x20;    yaml íŒŒì¼ì—ì„œ portë¥¼ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ë‹¤ë¥¸ podë“¤ê³¼ì˜ í†µì‹ ì€ ê°€ëŠ¥í•˜ë‹¤.

&#x20;    í•˜ì§€ë§Œ ëª…ì‹œí•¨ìœ¼ë¡œì¨ í•´ë‹¹ podê°€ ì–´ë–¤ portë¡œ ë…¸ì¶œë˜ì–´ ìˆëŠ”ì§€ ë¹ ë¥´ê²Œ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.

&#x20;  ğŸ”¹ kubernetes API ì˜¤ë¸Œì íŠ¸ í•„ë“œ í™•ì¸í•˜ê¸°

&#x20;    object ì˜ ì†ì„± í™•ì¸

```
root@master001:~/k8s_in_action/03_pod# kubectl explain pods
KIND:     Pod
VERSION:  v1

DESCRIPTION:
     Pod is a collection of containers that can run on a host. This resource is
     created by clients and scheduled onto hosts.

FIELDS:
   apiVersion   <string>
     APIVersion defines the versioned schema of this representation of an
     object. Servers should convert recognized schemas to the latest internal
     value, and may reject unrecognized values. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources

   kind <string>
     Kind is a string value representing the REST resource this object
     represents. Servers may infer this from the endpoint the client submits
     requests to. Cannot be updated. In CamelCase. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds

   metadata     <Object>
     Standard object metadata. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata

   spec <Object>
     Specification of the desired behavior of the pod. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status

   status       <Object>
     Most recently observed status of the pod. This data may not be up to date.
     Populated by the system. Read-only. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status
```

&#x20;  ê° ì†ì„±ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ í™•ì¸

```
root@master001:~/k8s_in_action/03_pod# kubectl explain pod.metadata
KIND:     Pod
VERSION:  v1

RESOURCE: metadata <Object>

DESCRIPTION:
     Standard objects metadata. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata

     ObjectMeta is metadata that all persisted resources must have, which
     includes all objects users must create.

FIELDS:
   annotations  <map[string]string>
     Annotations is an unstructured key value map stored with a resource that
     may be set by external tools to store and retrieve arbitrary metadata. They
     are not queryable and should be preserved when modifying objects. More
     info: http://kubernetes.io/docs/user-guide/annotations

   clusterName  <string>
     The name of the cluster which the object belongs to. This is used to
     distinguish resources with same name and namespace in different clusters.
     This field is not set anywhere right now and apiserver is going to ignore
     it if set in create or update request.
     
... ìƒëµ
```

3.2.3 \[ kubectl create ] Pod ìƒì„±í•˜ê¸°

ë‹¤ìŒê³¼ ê°™ì´ yaml , json ëª…ì„¸ì„œë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```
root@master001:~/k8s_in_action/03_pod# kubectl create -f kubia-manual.yaml
pod/kubia-manual created

root@master001:~/k8s_in_action/03_pod# kubectl get po kubia-manual
NAME           READY   STATUS    RESTARTS   AGE
kubia-manual   1/1     Running   0          22s
```

ì‹¤í–‰ ì¤‘ì¸ podì˜ ì „ì²´ ì •ì˜ í™•ì¸í•˜ê¸°

ì´ë•Œ -o ì˜µì…˜ì„ yaml/jsonìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```
root@master001:~/k8s_in_action/03_pod# kubectl get po kubia-manual -o yaml
```

3.2.4 Application log ë³´ê¸°

containerë¡œ ë™ì‘í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë¡œê·¸ë¥¼ í‘œì¤€ ì¶œë ¥, í‘œì¤€ ì—ëŸ¬ë¡œ ë‚¨ê¸´ë‹¤.

ì»¨í…Œì´ë„ˆì˜ ë¡œê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í•œë‹¤.

```
root@master001:~/k8s_in_action/03_pod# kubectl logs kubia-manual
Kubia server starting...
```

pod ì—ì„œ -c ì˜µì…˜ìœ¼ë¡œ íŠ¹ì • containerì˜ ë¡œê·¸ë§Œ ë³¼ ìˆ˜ë„ ìˆë‹¤.

```
root@master001:~# kubectl logs kubia-manual -c kubia
Kubia server starting...
```

ì´ë•Œ podê°€ ì‚­ì œë˜ë©´ ë¡œê·¸ë„ ì‚­ì œëœë‹¤. podê°€ ì‚­ì œëœ í›„ì—ë„ ë¡œê·¸ë¥¼ ë³´ê¸° ìœ„í•´ì„œëŠ” ì¤‘ì•™ì§‘ì¤‘ì‹ ë¡œê¹…ì„ ì„¤ì •í•˜ì—¬ ëª¨ë“  ë¡œê·¸ë¥¼ ì¤‘ì•™ ì €ì¥ì†Œì— ì €ì¥í•˜ë„ë¡ í•´ì•¼í•œë‹¤.

3.2.5 Podì— ìš”ì²­ ë³´ë‚´ê¸°

&#x20;port forwardingì„ í•˜ì—¬ podì— ìš”ì²­ì„ ë³´ë‚´ ë³´ë„ë¡ í•œë‹¤.

&#x20;  ğŸ”¹ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ë¥¼ podì˜ í¬íŠ¸ë¡œ í¬ì›Œë”© í•˜ê¸°

&#x20;   serviceë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  íŠ¹ì • podì™€ í†µì‹ í•˜ê¸° ìœ„í•´ì„œ ë¡œì»¬ nodeì˜ í¬íŠ¸ì™€ podì˜ í¬íŠ¸ë¥¼ ë§¤í•‘í•˜ì—¬ í¬íŠ¸ í¬ì›Œë”©í•  ìˆ˜ ìˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ë©´ ë¡œì»¬ ë¨¸ì‹ ì˜ 8888 portë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ í•´ë‹¹ podì˜ 8080 portë¡œ í–¥í•˜ê²Œ í•œë‹¤.

```
root@master001:~# kubectl port-forward kubia-manual 8888:8080 &
[1] 2949791

root@master001:~# curl localhost:8888
Handling connection for 8888
You ve hit kubia-manual

root@master001:~# kubectl logs kubia-manual
Kubia server starting...
Received request from ::ffff:127.0.0.1
```
